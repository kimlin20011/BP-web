<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Container Data</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="bower_components/moment/moment.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.3/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.3/daterangepicker.css"/>
    <script type="text/javascript" src="bower_components/DataTables/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bower_components/DataTables/datatables.min.css"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>

    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <style>
        .gm-style-iw + div {
            display: none;
        }

        .gm-style-iw {
            text-align: center;
        }
    </style>

</head>
<!-- ADD THE CLASS layout-top-nav TO REMOVE THE SIDEBAR. -->

<body class="hold-transition skin-blue layout-top-nav">
<div class="wrapper">
    <header class="main-header">
        <nav class="navbar navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <a href="/" class="navbar-brand"><b>Container</b>Data</a>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                            data-target="#navbar-collapse">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
                <div class="navbar-collapse collapse" id="navbar-collapse">
                    <ul hidden id="hiddenid" class="nav navbar-nav">
                        <li><a href="#" class="navbar">Device ID: <%= id%></a></li>
                    </ul>
                    <input hidden id="deviceid" name="id" value="<%= id%>">

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <ul class="nav navbar-nav navbar-right">
                        <li class=""><a href="/registerid" class="navbar">Register ID</a></li>
                    </ul>

                        <form action="/" method="get" class="navbar-form navbar-right" >
                            <div class="input-group">
                                <input type="text" name="id" class="form-control" id="navbar-search-input"
                                       placeholder="device-id">
                                <span class="input-group-btn">
                            <button type="submit"  id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                            </button>
                            </span>
                            </div>
                        </form>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>
    </header>
    <!-- Full Width Column -->
    <div class="content-wrapper">
        <div class="container">
            <!-- Content Header (Page header) -->
            <section class="content-header">
            </section>
            <div class="box box-primary">
                <div class="box-body">
                    <!-- Date and time range -->
                    <label>查詢時間區間</label>
                    <div class="form-group">
                        <form action="/searchbyidtime" method="get" >
                            <!-- <label>Date and time range:</label> -->
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <i class="fa fa-clock-o"></i>
                                </div>
                                <input hidden name="id" value="<%= id%>">
                                <input type="text" class="form-control pull-right" id="timeinterval" name="timeinterval">
                                <span class="input-group-btn">
                                <button type="submit"  id="searchbyidtime" class="btn btn-flat"
                                        style="background-color:#3c8dbc; color:#ffffff"><i class="fa fa-search"></i>
                                </button>
                              </span>
                            </div>
                            <!-- /.input group -->
                        </form>
                    </div>
                    <!-- /.form group -->
                    <!-- Date and time range -->
                </div>
                <!-- /.box-body -->
            </div>
            <div class="box box-success">
                <div class="box-header">
                    <h3 class="box-title">運送路徑資訊</h3>
                </div>
                <div id="map" style="height: 433px; margin: 0px; padding: 0px;" class="box-body"></div>

            </div>
            <div class="box box-warning">
                <div class="box-header with-border">
                    <h3 class="box-title">溫濕度圖表</h3>
                </div>
                <div class="box-body">
                    <div class="chart">
                        <canvas id="areaChart" style="height: 249px; width: 675px;" width="1350" height="498"></canvas>
                    </div>
                </div>
                <!-- /.box-body -->
            </div>
            <div class="box box-danger">
                <div class="box-header">
                    <h3 class="box-title">資料列表</h3>
                </div>
                <table id="datatable" class="display" width="100%"></table>
            </div>

            <!-- Main content -->
        </div>
        <!-- /.container -->
    </div>
    <!-- /.content-wrapper -->
</div>


<!-- ./wrapper -->

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAprpUrbF7bXWIzEKLF0s8sRMi4lqs7uY8&callback=initMap">
</script>
<script>


    var marker;
    var map;
    var table;

    function initMap() {
        var myLatLng = {lat: 24.987088, lng: 121.573474};

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 20,
            center: myLatLng
        });

    }



    //製造跳動效果 暫時沒用
    function toggleBounce(marker) {
        if (marker.getAnimation() !== null) {
            marker.setAnimation(null);
        } else {
            marker.setAnimation(google.maps.Animation.BOUNCE);
        }
    }

    function setMarkers(_dataSet) {



        for (var i = 0; i < _dataSet.length; i++) {
            doMarkerSetTimeout(i,_dataSet);
        }
    }


    function doMarkerSetTimeout(i,_dataSet) {
        setTimeout(function () {
            var timestamp = _dataSet[i][1]
            var lat = _dataSet[i][2]
            var long = _dataSet[i][3]

            latlngset = new google.maps.LatLng(lat, long);

            var marker = new google.maps.Marker({
                map: map,
                title: timestamp,
                position: latlngset,
                animation: google.maps.Animation.DROP,
            });
            map.setCenter(marker.getPosition())

            var content = '</h3>' + timestamp + '</h3>';

            var infowindow = new google.maps.InfoWindow()

            google.maps.event.addListener(marker, 'mouseover', (function (marker, content, infowindow) {
                return function () {
                    infowindow.setContent(content);
                    infowindow.open(map, marker);
                    toggleBounce(marker)
                };
            })(marker, content, infowindow));

            google.maps.event.addListener(marker, 'mouseout', (function (marker, content, infowindow) {
                return function () {
                    infowindow.close(map, marker);
                    toggleBounce(marker)
                };
            })(marker, content, infowindow));
        }, i * 10);
    }

    var chartDataOption = {
        type: 'line',
        data:{
            labels: [],
            datasets: [{
                label: 'temperature',
                yAxisID: 'temperature',
                fill: false,
                // backgroundColor: 'rgba(255, 127, 80,0.3)',
                borderColor: "rgba(255, 127, 80,0.5)",
                data: []

            }, {
                label: 'humidity',
                yAxisID: 'humidity',
                fill: false,
                // backgroundColor: 'rgba(30, 144, 255,0.3)',
                borderColor: 'rgba(30, 144, 255,0.5)',
                data: []

            }],
        },
        options : {
            responsive: true,
            title: {
                display: true,
                text: 'Chart.js Line Chart'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                yAxes: [{
                    id: 'temperature',
                    type: 'linear',
                    position: 'left',
                    ticks: {
                        max: 30,
                        min: 20
                    }
                }, {
                    id: 'humidity',
                    type: 'linear',
                    position: 'right',
                    ticks: {
                        max: 50,
                        min: 30
                    }
                }]
            }
        }
    };





    $(function () {
        $('input[name="timeinterval"]').daterangepicker({
            timePicker: true,
            startDate: moment().startOf('hour'),
            endDate: moment().startOf('hour').add(16, 'hour'),
            locale: {
                format: 'YYYY-MM-DD HH:mm:ss'
            }
        });
        console.log($("#timeinterval").val().toString());
        console.log($("#deviceid").val());
        if( $("#deviceid").val() != "" &&  $("#deviceid").val() != undefined ){
            $("#hiddenid").show();
        }

    });

    $(function () {
        initMap()
        var dataSet = [];
        var labels = [];
        var temperatures = [];
        var humiditys = [];

        var tmpdataSet = [];
        var tmplabels = [];
        var tmptemperatures = [];
        var tmphumiditys = [];

        var dataAPI = 'http://192.168.4.204:3000';
        //將資料用ajax抓取後動態顯示在前端
        $.getJSON(dataAPI,{id:$("#deviceid").val()}, function (data) {


            console.log(data);
            // var data = [{"c_index":27,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:10:11.000Z","lat":"24.592426999999997","lng":"121.344092","temperature":"28","humidity":"36","info":"test"},{"c_index":28,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:12:51.000Z","lat":"24.592463","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":29,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:13:00.000Z","lat":"24.592449000000002","lng":"121.344129","temperature":"28","humidity":"35","info":"test"},{"c_index":30,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:14:31.000Z","lat":"24.592453999999996","lng":"121.344133","temperature":"28","humidity":"36","info":"test"},{"c_index":31,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:01.000Z","lat":"24.592460000000003","lng":"121.344133","temperature":"28","humidity":"36","info":"test"},{"c_index":32,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:11.000Z","lat":"24.592465999999998","lng":"121.344152","temperature":"28","humidity":"36","info":"test"},{"c_index":33,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:21.000Z","lat":"24.592462","lng":"121.344153","temperature":"28","humidity":"36","info":"test"},{"c_index":34,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:31.000Z","lat":"24.592467000000003","lng":"121.344139","temperature":"28","humidity":"36","info":"test"},{"c_index":35,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:41.000Z","lat":"24.592468","lng":"121.34413599999999","temperature":"28","humidity":"35","info":"test"},{"c_index":36,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:51.000Z","lat":"24.592462","lng":"121.344143","temperature":"28","humidity":"36","info":"test"},{"c_index":37,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:01.000Z","lat":"24.592438","lng":"121.344161","temperature":"28","humidity":"36","info":"test"},{"c_index":38,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:11.000Z","lat":"24.59243","lng":"121.344184","temperature":"28","humidity":"35","info":"test"},{"c_index":39,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:21.000Z","lat":"24.592416","lng":"121.34421200000001","temperature":"28","humidity":"35","info":"test"},{"c_index":40,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:31.000Z","lat":"24.592404000000002","lng":"121.344236","temperature":"28","humidity":"36","info":"test"},{"c_index":41,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:41.000Z","lat":"24.592426999999997","lng":"121.34422699999999","temperature":"28","humidity":"35","info":"test"},{"c_index":42,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:51.000Z","lat":"24.592416","lng":"121.344219","temperature":"28","humidity":"35","info":"test"},{"c_index":43,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:01.000Z","lat":"24.592424","lng":"121.34418600000001","temperature":"28","humidity":"35","info":"test"},{"c_index":44,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:11.000Z","lat":"24.59243","lng":"121.344161","temperature":"28","humidity":"35","info":"test"},{"c_index":45,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:21.000Z","lat":"24.592432","lng":"121.344141","temperature":"28","humidity":"35","info":"test"},{"c_index":46,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:31.000Z","lat":"24.592420999999998","lng":"121.344162","temperature":"28","humidity":"35","info":"test"},{"c_index":47,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:41.000Z","lat":"24.592436","lng":"121.344111","temperature":"28","humidity":"35","info":"test"},{"c_index":48,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:51.000Z","lat":"24.592440999999997","lng":"121.344087","temperature":"28","humidity":"35","info":"test"},{"c_index":49,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:01.000Z","lat":"24.59245","lng":"121.34406499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":50,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:11.000Z","lat":"24.592433","lng":"121.344101","temperature":"28","humidity":"35","info":"test"},{"c_index":51,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:21.000Z","lat":"24.592427999999998","lng":"121.344133","temperature":"28","humidity":"35","info":"test"},{"c_index":52,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:31.000Z","lat":"24.592437","lng":"121.34414000000001","temperature":"28","humidity":"35","info":"test"},{"c_index":53,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:41.000Z","lat":"24.592444999999998","lng":"121.344139","temperature":"28","humidity":"35","info":"test"},{"c_index":54,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:51.000Z","lat":"24.59244","lng":"121.344138","temperature":"28","humidity":"35","info":"test"},{"c_index":55,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:01.000Z","lat":"24.592420999999998","lng":"121.34413699999999","temperature":"27","humidity":"35","info":"test"},{"c_index":56,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:11.000Z","lat":"24.592419","lng":"121.34412","temperature":"28","humidity":"35","info":"test"},{"c_index":57,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:21.000Z","lat":"24.592442000000002","lng":"121.344125","temperature":"28","humidity":"35","info":"test"},{"c_index":58,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:31.000Z","lat":"24.59245","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":59,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:41.000Z","lat":"24.59244","lng":"121.344134","temperature":"28","humidity":"35","info":"test"},{"c_index":60,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:51.000Z","lat":"24.592437","lng":"121.344123","temperature":"27","humidity":"35","info":"test"},{"c_index":61,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:01.000Z","lat":"24.592443","lng":"121.34413","temperature":"28","humidity":"35","info":"test"},{"c_index":62,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:11.000Z","lat":"24.592437","lng":"121.34416999999999","temperature":"28","humidity":"35","info":"test"},{"c_index":63,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:21.000Z","lat":"24.592457","lng":"121.344157","temperature":"28","humidity":"35","info":"test"},{"c_index":64,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:31.000Z","lat":"24.592474000000003","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":65,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:41.000Z","lat":"24.592478","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":66,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:51.000Z","lat":"24.592478999999997","lng":"121.34412","temperature":"28","humidity":"35","info":"test"},{"c_index":67,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:01.000Z","lat":"24.592483","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":68,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:11.000Z","lat":"24.592485","lng":"121.344128","temperature":"28","humidity":"35","info":"test"},{"c_index":69,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:21.000Z","lat":"24.592488","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":70,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:31.000Z","lat":"24.592485999999997","lng":"121.344118","temperature":"28","humidity":"35","info":"test"},{"c_index":71,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:41.000Z","lat":"24.592487000000002","lng":"121.344129","temperature":"28","humidity":"35","info":"test"},{"c_index":72,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:51.000Z","lat":"24.592485999999997","lng":"121.344167","temperature":"28","humidity":"35","info":"test"},{"c_index":73,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:01.000Z","lat":"24.592467000000003","lng":"121.344184","temperature":"28","humidity":"35","info":"test"},{"c_index":74,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:11.000Z","lat":"24.592460000000003","lng":"121.34419","temperature":"28","humidity":"35","info":"test"},{"c_index":75,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:21.000Z","lat":"24.592456000000002","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":76,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:31.000Z","lat":"24.592435000000002","lng":"121.344203","temperature":"28","humidity":"35","info":"test"},{"c_index":77,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:41.000Z","lat":"24.592438","lng":"121.344182","temperature":"28","humidity":"36","info":"test"},{"c_index":78,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:51.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":79,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:01.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":80,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:11.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":81,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:21.000Z","lat":"24.592439","lng":"121.34418600000001","temperature":"28","humidity":"36","info":"test"},{"c_index":82,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:31.000Z","lat":"24.592427999999998","lng":"121.344191","temperature":"28","humidity":"35","info":"test"},{"c_index":83,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:41.000Z","lat":"24.592427999999998","lng":"121.344177","temperature":"28","humidity":"35","info":"test"},{"c_index":84,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:51.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":85,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:01.000Z","lat":"24.592424","lng":"121.34417499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":86,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:11.000Z","lat":"24.592425","lng":"121.344181","temperature":"28","humidity":"36","info":"test"},{"c_index":87,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:21.000Z","lat":"24.592432","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":88,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:31.000Z","lat":"24.592439","lng":"121.344178","temperature":"28","humidity":"36","info":"test"},{"c_index":89,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:41.000Z","lat":"24.592443","lng":"121.344178","temperature":"28","humidity":"35","info":"test"},{"c_index":90,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:51.000Z","lat":"24.592433","lng":"121.344189","temperature":"28","humidity":"35","info":"test"},{"c_index":91,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:01.000Z","lat":"24.592427999999998","lng":"121.344194","temperature":"28","humidity":"36","info":"test"},{"c_index":92,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:11.000Z","lat":"24.59242","lng":"121.3442","temperature":"28","humidity":"35","info":"test"},{"c_index":93,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:21.000Z","lat":"24.592420999999998","lng":"121.344195","temperature":"28","humidity":"36","info":"test"},{"c_index":94,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:31.000Z","lat":"24.592435000000002","lng":"121.344182","temperature":"28","humidity":"36","info":"test"},{"c_index":95,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:41.000Z","lat":"24.592437","lng":"121.34416300000001","temperature":"28","humidity":"36","info":"test"},{"c_index":96,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:51.000Z","lat":"24.59244","lng":"121.344153","temperature":"28","humidity":"36","info":"test"},{"c_index":97,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:01.000Z","lat":"24.592420999999998","lng":"121.344164","temperature":"28","humidity":"36","info":"test"},{"c_index":98,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:11.000Z","lat":"24.592433","lng":"121.344156","temperature":"28","humidity":"36","info":"test"},{"c_index":99,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:21.000Z","lat":"24.592449000000002","lng":"121.344152","temperature":"28","humidity":"36","info":"test"},{"c_index":100,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:31.000Z","lat":"null","lng":"null","temperature":"28","humidity":"35","info":"test"},{"c_index":101,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:41.000Z","lat":"24.592431","lng":"121.344164","temperature":"28","humidity":"36","info":"test"},{"c_index":102,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:51.000Z","lat":"24.59243","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":103,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:01.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":104,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:11.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":105,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:21.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":106,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:31.000Z","lat":"24.592427999999998","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":107,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:41.000Z","lat":"24.592427999999998","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":108,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:51.000Z","lat":"24.592425","lng":"121.344157","temperature":"28","humidity":"36","info":"test"},{"c_index":109,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:01.000Z","lat":"24.592422000000003","lng":"121.344154","temperature":"28","humidity":"36","info":"test"},{"c_index":110,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:11.000Z","lat":"24.592394","lng":"121.344189","temperature":"28","humidity":"36","info":"test"},{"c_index":111,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:21.000Z","lat":"24.59238","lng":"121.344206","temperature":"28","humidity":"35","info":"test"},{"c_index":112,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:31.000Z","lat":"24.592382999999998","lng":"121.34421200000001","temperature":"28","humidity":"36","info":"test"},{"c_index":113,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:41.000Z","lat":"24.592399999999998","lng":"121.34422","temperature":"28","humidity":"35","info":"test"},{"c_index":114,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:51.000Z","lat":"24.592440999999997","lng":"121.344201","temperature":"28","humidity":"36","info":"test"}];
            for (var k in data) {
                // console.log(k, data[k]);
                dataSet.push([data[k].pi_mac, new Date(data[k].timestamp).toLocaleString(), Number(data[k].lat) + 0.394613, Number(data[k].lng) + 0.229376, data[k].temperature, data[k].humidity]);
                labels.push(new Date(data[k].timestamp).toLocaleString());
                temperatures.push(data[k].temperature);
                humiditys.push(data[k].humidity);
            }
            // console.log(dataSet)

            $(document).ready(function () {
                table = $('#datatable').DataTable({
                    data: dataSet,
                    columns: [
                        {title: "pi_mac"},
                        {title: "timestamp"},
                        {title: "lat"},
                        {title: "lng"},
                        {title: "temperature"},
                        {title: "humidity"}
                    ]
                });
                table.order( [ 1, 'desc' ] ).draw();
            });


            setMarkers(dataSet)


            chartDataOption.data.labels = labels;
            chartDataOption.data.datasets[0].data = temperatures;
            chartDataOption.data.datasets[1].data = humiditys;

            // Get context with jQuery - using jQuery's .get() method.
            var ChartCanvas = $('#areaChart').get(0).getContext('2d')
            // This will get the first returned node in the jQuery collection.
            window.myLine = new Chart(ChartCanvas,chartDataOption);
        })

        var ii=0;
        setInterval(function () {
            // console.table(dataSet)
            $.getJSON(dataAPI,{id:$("#deviceid").val()}, function (data) {
                console.log(data);
                // var data = [{"c_index":27,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:10:11.000Z","lat":"24.592426999999997","lng":"121.344092","temperature":"28","humidity":"36","info":"test"},{"c_index":28,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:12:51.000Z","lat":"24.592463","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":29,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:13:00.000Z","lat":"24.592449000000002","lng":"121.344129","temperature":"28","humidity":"35","info":"test"},{"c_index":30,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:14:31.000Z","lat":"24.592453999999996","lng":"121.344133","temperature":"28","humidity":"36","info":"test"},{"c_index":31,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:01.000Z","lat":"24.592460000000003","lng":"121.344133","temperature":"28","humidity":"36","info":"test"},{"c_index":32,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:11.000Z","lat":"24.592465999999998","lng":"121.344152","temperature":"28","humidity":"36","info":"test"},{"c_index":33,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:21.000Z","lat":"24.592462","lng":"121.344153","temperature":"28","humidity":"36","info":"test"},{"c_index":34,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:31.000Z","lat":"24.592467000000003","lng":"121.344139","temperature":"28","humidity":"36","info":"test"},{"c_index":35,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:41.000Z","lat":"24.592468","lng":"121.34413599999999","temperature":"28","humidity":"35","info":"test"},{"c_index":36,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:15:51.000Z","lat":"24.592462","lng":"121.344143","temperature":"28","humidity":"36","info":"test"},{"c_index":37,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:01.000Z","lat":"24.592438","lng":"121.344161","temperature":"28","humidity":"36","info":"test"},{"c_index":38,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:11.000Z","lat":"24.59243","lng":"121.344184","temperature":"28","humidity":"35","info":"test"},{"c_index":39,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:21.000Z","lat":"24.592416","lng":"121.34421200000001","temperature":"28","humidity":"35","info":"test"},{"c_index":40,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:31.000Z","lat":"24.592404000000002","lng":"121.344236","temperature":"28","humidity":"36","info":"test"},{"c_index":41,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:41.000Z","lat":"24.592426999999997","lng":"121.34422699999999","temperature":"28","humidity":"35","info":"test"},{"c_index":42,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:16:51.000Z","lat":"24.592416","lng":"121.344219","temperature":"28","humidity":"35","info":"test"},{"c_index":43,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:01.000Z","lat":"24.592424","lng":"121.34418600000001","temperature":"28","humidity":"35","info":"test"},{"c_index":44,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:11.000Z","lat":"24.59243","lng":"121.344161","temperature":"28","humidity":"35","info":"test"},{"c_index":45,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:21.000Z","lat":"24.592432","lng":"121.344141","temperature":"28","humidity":"35","info":"test"},{"c_index":46,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:31.000Z","lat":"24.592420999999998","lng":"121.344162","temperature":"28","humidity":"35","info":"test"},{"c_index":47,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:41.000Z","lat":"24.592436","lng":"121.344111","temperature":"28","humidity":"35","info":"test"},{"c_index":48,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:17:51.000Z","lat":"24.592440999999997","lng":"121.344087","temperature":"28","humidity":"35","info":"test"},{"c_index":49,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:01.000Z","lat":"24.59245","lng":"121.34406499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":50,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:11.000Z","lat":"24.592433","lng":"121.344101","temperature":"28","humidity":"35","info":"test"},{"c_index":51,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:21.000Z","lat":"24.592427999999998","lng":"121.344133","temperature":"28","humidity":"35","info":"test"},{"c_index":52,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:31.000Z","lat":"24.592437","lng":"121.34414000000001","temperature":"28","humidity":"35","info":"test"},{"c_index":53,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:41.000Z","lat":"24.592444999999998","lng":"121.344139","temperature":"28","humidity":"35","info":"test"},{"c_index":54,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:18:51.000Z","lat":"24.59244","lng":"121.344138","temperature":"28","humidity":"35","info":"test"},{"c_index":55,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:01.000Z","lat":"24.592420999999998","lng":"121.34413699999999","temperature":"27","humidity":"35","info":"test"},{"c_index":56,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:11.000Z","lat":"24.592419","lng":"121.34412","temperature":"28","humidity":"35","info":"test"},{"c_index":57,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:21.000Z","lat":"24.592442000000002","lng":"121.344125","temperature":"28","humidity":"35","info":"test"},{"c_index":58,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:31.000Z","lat":"24.59245","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":59,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:41.000Z","lat":"24.59244","lng":"121.344134","temperature":"28","humidity":"35","info":"test"},{"c_index":60,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:19:51.000Z","lat":"24.592437","lng":"121.344123","temperature":"27","humidity":"35","info":"test"},{"c_index":61,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:01.000Z","lat":"24.592443","lng":"121.34413","temperature":"28","humidity":"35","info":"test"},{"c_index":62,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:11.000Z","lat":"24.592437","lng":"121.34416999999999","temperature":"28","humidity":"35","info":"test"},{"c_index":63,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:21.000Z","lat":"24.592457","lng":"121.344157","temperature":"28","humidity":"35","info":"test"},{"c_index":64,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:31.000Z","lat":"24.592474000000003","lng":"121.344131","temperature":"28","humidity":"35","info":"test"},{"c_index":65,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:41.000Z","lat":"24.592478","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":66,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:20:51.000Z","lat":"24.592478999999997","lng":"121.34412","temperature":"28","humidity":"35","info":"test"},{"c_index":67,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:01.000Z","lat":"24.592483","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":68,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:11.000Z","lat":"24.592485","lng":"121.344128","temperature":"28","humidity":"35","info":"test"},{"c_index":69,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:21.000Z","lat":"24.592488","lng":"121.344124","temperature":"28","humidity":"35","info":"test"},{"c_index":70,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:31.000Z","lat":"24.592485999999997","lng":"121.344118","temperature":"28","humidity":"35","info":"test"},{"c_index":71,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:41.000Z","lat":"24.592487000000002","lng":"121.344129","temperature":"28","humidity":"35","info":"test"},{"c_index":72,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:21:51.000Z","lat":"24.592485999999997","lng":"121.344167","temperature":"28","humidity":"35","info":"test"},{"c_index":73,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:01.000Z","lat":"24.592467000000003","lng":"121.344184","temperature":"28","humidity":"35","info":"test"},{"c_index":74,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:11.000Z","lat":"24.592460000000003","lng":"121.34419","temperature":"28","humidity":"35","info":"test"},{"c_index":75,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:21.000Z","lat":"24.592456000000002","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":76,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:31.000Z","lat":"24.592435000000002","lng":"121.344203","temperature":"28","humidity":"35","info":"test"},{"c_index":77,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:41.000Z","lat":"24.592438","lng":"121.344182","temperature":"28","humidity":"36","info":"test"},{"c_index":78,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:22:51.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":79,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:01.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":80,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:11.000Z","lat":"24.592443","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":81,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:21.000Z","lat":"24.592439","lng":"121.34418600000001","temperature":"28","humidity":"36","info":"test"},{"c_index":82,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:31.000Z","lat":"24.592427999999998","lng":"121.344191","temperature":"28","humidity":"35","info":"test"},{"c_index":83,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:41.000Z","lat":"24.592427999999998","lng":"121.344177","temperature":"28","humidity":"35","info":"test"},{"c_index":84,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:23:51.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":85,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:01.000Z","lat":"24.592424","lng":"121.34417499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":86,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:11.000Z","lat":"24.592425","lng":"121.344181","temperature":"28","humidity":"36","info":"test"},{"c_index":87,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:21.000Z","lat":"24.592432","lng":"121.34418","temperature":"28","humidity":"35","info":"test"},{"c_index":88,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:31.000Z","lat":"24.592439","lng":"121.344178","temperature":"28","humidity":"36","info":"test"},{"c_index":89,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:41.000Z","lat":"24.592443","lng":"121.344178","temperature":"28","humidity":"35","info":"test"},{"c_index":90,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:24:51.000Z","lat":"24.592433","lng":"121.344189","temperature":"28","humidity":"35","info":"test"},{"c_index":91,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:01.000Z","lat":"24.592427999999998","lng":"121.344194","temperature":"28","humidity":"36","info":"test"},{"c_index":92,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:11.000Z","lat":"24.59242","lng":"121.3442","temperature":"28","humidity":"35","info":"test"},{"c_index":93,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:21.000Z","lat":"24.592420999999998","lng":"121.344195","temperature":"28","humidity":"36","info":"test"},{"c_index":94,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:31.000Z","lat":"24.592435000000002","lng":"121.344182","temperature":"28","humidity":"36","info":"test"},{"c_index":95,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:41.000Z","lat":"24.592437","lng":"121.34416300000001","temperature":"28","humidity":"36","info":"test"},{"c_index":96,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:25:51.000Z","lat":"24.59244","lng":"121.344153","temperature":"28","humidity":"36","info":"test"},{"c_index":97,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:01.000Z","lat":"24.592420999999998","lng":"121.344164","temperature":"28","humidity":"36","info":"test"},{"c_index":98,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:11.000Z","lat":"24.592433","lng":"121.344156","temperature":"28","humidity":"36","info":"test"},{"c_index":99,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:21.000Z","lat":"24.592449000000002","lng":"121.344152","temperature":"28","humidity":"36","info":"test"},{"c_index":100,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:31.000Z","lat":"null","lng":"null","temperature":"28","humidity":"35","info":"test"},{"c_index":101,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:41.000Z","lat":"24.592431","lng":"121.344164","temperature":"28","humidity":"36","info":"test"},{"c_index":102,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:26:51.000Z","lat":"24.59243","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":103,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:01.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":104,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:11.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":105,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:21.000Z","lat":"24.592429000000003","lng":"121.34416499999999","temperature":"28","humidity":"35","info":"test"},{"c_index":106,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:31.000Z","lat":"24.592427999999998","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":107,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:41.000Z","lat":"24.592427999999998","lng":"121.34416499999999","temperature":"28","humidity":"36","info":"test"},{"c_index":108,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:27:51.000Z","lat":"24.592425","lng":"121.344157","temperature":"28","humidity":"36","info":"test"},{"c_index":109,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:01.000Z","lat":"24.592422000000003","lng":"121.344154","temperature":"28","humidity":"36","info":"test"},{"c_index":110,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:11.000Z","lat":"24.592394","lng":"121.344189","temperature":"28","humidity":"36","info":"test"},{"c_index":111,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:21.000Z","lat":"24.59238","lng":"121.344206","temperature":"28","humidity":"35","info":"test"},{"c_index":112,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:31.000Z","lat":"24.592382999999998","lng":"121.34421200000001","temperature":"28","humidity":"36","info":"test"},{"c_index":113,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:41.000Z","lat":"24.592399999999998","lng":"121.34422","temperature":"28","humidity":"35","info":"test"},{"c_index":114,"pi_mac":"b8:27:eb:e7:a3","timestamp":"2018-08-23T09:28:51.000Z","lat":"24.592440999999997","lng":"121.344201","temperature":"28","humidity":"36","info":"test"}];


                for (var v of data){
                    var haveequal=0
                    // console.log(v.timestamp);
                    for(var vv of dataSet){
                        // console.log(vv[1]);
                        if( new Date(v.timestamp).toLocaleString() === vv[1] ){
                            haveequal = 1;
                        }
                    }
                    if(haveequal === 0) {
                        console.log(ii++);
                        console.log(new Date(v.timestamp).toLocaleString());
                        console.log(v);
                        tmpdataSet = [[v.pi_mac, new Date(v.timestamp).toLocaleString(), Number(v.lat) + 0.394613, Number(v.lng) + 0.229376, v.temperature, v.humidity]];
                        tmplabels = new Date(v.timestamp).toLocaleString();
                        tmptemperatures = v.temperature;
                        tmphumiditys = v.humidity;


                        setMarkers(tmpdataSet)


                        chartDataOption.data.labels.push(tmplabels);
                        chartDataOption.data.datasets[0].data.push(tmptemperatures);
                        chartDataOption.data.datasets[1].data.push(tmphumiditys);

                        window.myLine.update();

                        table.row.add(tmpdataSet[0]).draw();


                        dataSet.push([v.pi_mac, new Date(v.timestamp).toLocaleString(), Number(v.lat) + 0.394613, Number(v.lng) + 0.229376, v.temperature, v.humidity]);
                        labels.push(new Date(v.timestamp).toLocaleString());
                        temperatures.push(v.temperature);
                        humiditys.push(v.humidity);

                    }
                }

                // tmpdataSet = [["b8:27:eb:e7:a3", new Date("2018-09-05T08:05:17.000Z").toLocaleString(), 24.987088,  121.573474 , 30, 31]];
                // tmplabels = new Date("2018-09-03T08:05:17.000Z").toLocaleString();
                // tmptemperatures = 30;
                // tmphumiditys = 31;

                // console.log(dataSet)


            });


        },3000)


    });


</script>
<!-- jQuery 3 -->
<!-- <script src="bower_components/jquery/dist/jquery.min.js"></script> -->
<!-- Bootstrap 3.3.7 -->
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>

</body>

</html>